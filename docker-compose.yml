services:
  comfyui-mcp:
    build:
      context: .
      target: runtime
    ports:
      - "${HOST_PORT:-3003}:3000"
    environment:
      PORT: 3000
    volumes:
      - ./workflows:/app/workflows
      - ./config:/app/config
    healthcheck:
      test:
        [
          "CMD",
          "node",
          "-e",
          "fetch('http://localhost:3000/healthz').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))"
        ]
      interval: 10s
      timeout: 3s
      retries: 5

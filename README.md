# comfyui-mcp

Минимальный каркас сервиса для интеграции с ComfyUI и MCP. Проект ориентирован на
расширяемость: базовая структура и зависимости уже заданы, чтобы в дальнейшем можно
было добавлять модули, обработчики и схемы в одном месте без переписывания основы.

## Цели

- Единая точка входа для будущих API и интеграций.
- Валидация входных данных (через Zod/Ajv) и конфигурации.
- Простая разработка и запуск в контейнере.

## Схема конфигурации инструментов

В `config/schema/tool-config.schema.json` описан формат конфигурации инструментов:
каждый инструмент содержит `name`, `description` и набор `fields`. Поля привязываются
к конкретной ноде графа через `mapping` (пара `node` + `attribute`) и при необходимости
могут иметь генератор значения (`generator`) с типом `seed` или `random` и расширяемыми
опциями. Пример файла находится в `config/tools.example.json`: он показывает, как
подменить поле `text` у узла `CLIPTextEncode` и сгенерировать `seed` для `KSampler`.

## Workflows

Workflow — это экспортированный из ComfyUI граф (формат API export), который хранится
в каталоге `workflows/`. Такой файл можно использовать как шаблон для последующей
параметризации, связывания с инструментами или запуска в ComfyUI API.

Минимальные требования к структуре workflow:
- Корневой объект JSON.
- `nodes`: массив узлов, где у каждого узла есть минимум `id` (число) и `type`
  (строка). Дополнительные поля пропускаются для расширяемости.
- `links`: массив связей (может быть пустым).

Пример: `workflows/example-workflow.json`.

Для загрузки и базовой валидации используется модуль `src/core/workflowLoader.js`,
который читает JSON из каталога `workflows/` и проверяет базовую структуру через Zod.
Это оставляет место для расширения схемы (добавления метаданных, версий и т.д.).

## Быстрый старт (Docker)

```bash
# Сборка образа (используем официальный Node.js образ)
docker build -t comfyui-mcp - <<'DOCKERFILE'
FROM node:20-alpine
WORKDIR /app
COPY package.json package-lock.json* ./
RUN npm install --omit=dev
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
DOCKERFILE

# Запуск контейнера
docker run --rm -p 3000:3000 --env-file .env comfyui-mcp
```

> Для локальной разработки используйте `npm run dev`.
